<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Green Earth — Plant a Tree</title>

  <!-- Tailwind Play CDN (convenient for prototypes) and DaisyUI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Enable DaisyUI plugin via Tailwind CDN config
    tailwind.config = {
      plugins: [window.tailwindcss && window.tailwindcss.plugin ? window.tailwindcss.plugin(function(){}) : ()=>{}],
      theme: {
        extend: {}
      },
    }
  </script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.6/dist/full.css" rel="stylesheet"/>
  <style>
    /* Small custom styles */
    .card-img-placeholder {
      background: linear-gradient(90deg,#e6f2ea,#f4faf5);
      height: 160px;
      border-radius: 8px;
    }
    /* modal overlay tweak */
    .modal-open {
      display: block;
    }
  </style>
</head>
<body class="bg-emerald-50 text-slate-800">

  <!-- NAVBAR -->
  <header class="bg-emerald-800 text-white">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="text-lg font-semibold">Green Earth</div>
      </div>

      <nav class="hidden md:flex gap-8">
        <a class="hover:underline" href="#about">About</a>
        <a class="hover:underline" href="#gallery">Gallery</a>
        <a class="hover:underline" href="#plant">Plant a Tree</a>
      </nav>

      <div>
        <button id="plantTopBtn" class="bg-yellow-400 text-emerald-900 px-4 py-1 rounded-full shadow">Plant a Tree</button>
      </div>
    </div>
  </header>

  <!-- BANNER -->
  <section class="bg-[url('')] bg-cover bg-center" style="background-color: #dff5e8;">
    <div class="container mx-auto px-4 py-16 text-center">
      <h1 class="text-3xl md:text-4xl font-bold text-emerald-900">Plant a Tree, Grow a Future</h1>
      <p class="mt-4 text-sm md:text-base text-emerald-700">Join our mission to plant 1 million trees and make the Earth greener for future generations.</p>
      <div class="mt-6">
        <button id="getInvolvedBtn" class="px-5 py-2 bg-yellow-400 rounded-full text-emerald-900 font-semibold">Get Involved</button>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <main class="container mx-auto px-4 py-12 grid gap-8 lg:grid-cols-4">
    <!-- LEFT: Categories -->
    <aside class="lg:col-span-1">
      <div class="bg-white p-4 rounded shadow-sm">
        <h3 class="font-semibold mb-3">Categories</h3>
        <div id="categories" class="flex flex-col gap-2"></div>
      </div>
    </aside>

    <!-- CENTER: Cards -->
    <section id="cardsSection" class="lg:col-span-2">
      <div class="text-center mb-6">
        <h2 class="text-xl font-semibold">Choose Your Trees</h2>
      </div>

      <!-- Spinner -->
      <div id="spinner" class="hidden justify-center items-center py-8">
        <div class="loading loading-dots loading-lg"></div>
      </div>

      <div id="cardsGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
    </section>

    <!-- RIGHT: Cart -->
    <aside class="lg:col-span-1">
      <div class="bg-white p-4 rounded shadow-sm sticky top-6">
        <h3 class="font-semibold mb-3">Your Cart</h3>
        <div id="cartList" class="space-y-2"></div>
        <div class="mt-4 border-t pt-3 flex items-center justify-between">
          <strong>Total:</strong>
          <span id="cartTotal">৳0</span>
        </div>
        <div class="mt-4">
          <button id="checkoutBtn" class="w-full bg-emerald-700 text-white py-2 rounded">Checkout</button>
        </div>
      </div>
    </aside>
  </main>

  <!-- ABOUT SECTION -->
  <section id="about" class="container mx-auto px-4 py-12">
    <h3 class="text-center text-lg font-semibold mb-8">About the Campaign</h3>
    <div class="grid gap-8 md:grid-cols-2 items-center">
      <div>
        <!-- if you want to use the screenshot asset, place it in the same folder and update src below -->
        <img id="aboutImg" src="" alt="plant" class="rounded shadow-md w-full object-cover max-h-96">
      </div>
      <div class="text-slate-700">
        <p>Green Earth is a global tree plantation initiative dedicated to fighting climate change. Since our start, we've planted thousands of trees worldwide. By joining our campaign, you help restore forests, create habitats, and support local communities.</p>
        <ul class="mt-4 list-disc list-inside text-sm">
          <li>Restoration of natural habitats</li>
          <li>Improvement of air quality</li>
          <li>Support for local communities</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- IMPACT -->
  <section class="bg-emerald-100 py-10">
    <div class="container mx-auto px-4">
      <h3 class="text-center text-lg font-semibold mb-6">Our Impact</h3>
      <div class="grid gap-6 md:grid-cols-3">
        <div class="bg-white p-6 rounded shadow text-center">
          <div class="text-2xl font-bold">500K+</div>
          <div class="text-sm text-slate-500 mt-1">Trees Planted</div>
        </div>
        <div class="bg-white p-6 rounded shadow text-center">
          <div class="text-2xl font-bold">120+</div>
          <div class="text-sm text-slate-500 mt-1">Communities Involved</div>
        </div>
        <div class="bg-white p-6 rounded shadow text-center">
          <div class="text-2xl font-bold">30+</div>
          <div class="text-sm text-slate-500 mt-1">Countries Reached</div>
        </div>
      </div>
    </div>
  </section>

  <!-- PLANT A TREE FORM -->
  <section id="plant" class="container mx-auto px-4 py-12">
    <h3 class="text-center text-lg font-semibold mb-6">Plant a Tree Today</h3>
    <div class="max-w-lg mx-auto bg-emerald-700 text-white p-6 rounded">
      <form id="donateForm" class="space-y-3">
        <input required name="name" placeholder="Your Name" class="w-full p-2 rounded text-slate-800" />
        <input required type="email" name="email" placeholder="Your Email Address" class="w-full p-2 rounded text-slate-800" />
        <select required name="count" class="w-full p-2 rounded text-slate-800">
          <option value="">Number of Trees</option>
          <option value="1">1</option>
          <option value="3">3</option>
          <option value="5">5</option>
          <option value="10">10</option>
        </select>
        <button class="w-full py-2 bg-yellow-400 rounded text-emerald-900 font-semibold">Donate Now</button>
      </form>
    </div>
  </section>

  <footer class="bg-emerald-900 text-white py-4">
    <div class="container mx-auto px-4 text-center text-sm">© 2025 Green Earth. All Rights Reserved.</div>
  </footer>

  <!-- Modal for plant detail -->
  <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white w-11/12 md:w-3/4 lg:w-1/2 rounded p-6 relative max-h-[80vh] overflow-auto">
      <button id="closeModal" class="absolute right-3 top-3 text-slate-500">✕</button>
      <div id="modalContent"></div>
    </div>
  </div>
<script>
/* ========== Configuration & Selectors ========== */
const API = {
  categories: 'https://openapi.programming-hero.com/api/categories',
  allPlants: 'https://openapi.programming-hero.com/api/plants',
  category: (id) => `https://openapi.programming-hero.com/api/category/${id}`,
  plant: (id) => `https://openapi.programming-hero.com/api/plant/${id}`,
};

const categoriesEl = document.getElementById('categories');
const cardsGrid = document.getElementById('cardsGrid');
const spinner = document.getElementById('spinner');
const cartList = document.getElementById('cartList');
const cartTotalEl = document.getElementById('cartTotal');
const detailModal = document.getElementById('detailModal');
const modalContent = document.getElementById('modalContent');
const closeModal = document.getElementById('closeModal');
const aboutImg = document.getElementById('aboutImg');

const localAboutImage = ''; // set to local filename if you want

if(localAboutImage) aboutImg.src = localAboutImage;

/* ========== State ========== */
let state = {
  categories: [],
  activeCategoryId: 'all', // default 'all'
  plants: [],
  cart: [],
};

/* ===== helpers ===== */
function showSpinner() {
  spinner.classList.remove('hidden');
  cardsGrid.classList.add('opacity-50');
}
function hideSpinner() {
  spinner.classList.add('hidden');
  cardsGrid.classList.remove('opacity-50');
}
function formatPrice(num){
  if (num === undefined || num === null || Number.isNaN(Number(num))) return '৳0';
  return `৳${Number(num).toLocaleString()}`;
}
function calcTotal(){
  const total = state.cart.reduce((s, item) => s + (item.price * item.qty), 0);
  cartTotalEl.textContent = formatPrice(total);
}
function renderCart(){
  cartList.innerHTML = '';
  if (state.cart.length === 0){
    cartList.innerHTML = '<div class="text-sm text-slate-500">Cart is empty</div>';
    cartTotalEl.textContent = '৳0';
    return;
  }
  state.cart.forEach(item => {
    const row = document.createElement('div');
    row.className = 'flex items-center justify-between bg-emerald-50 p-2 rounded';
    row.innerHTML = `
      <div class="text-sm">
        <div class="font-medium">${item.name}</div>
        <div class="text-xs text-slate-500">${item.qty} × ${formatPrice(item.price)}</div>
      </div>
      <div class="flex items-center gap-2">
        <button data-id="${item.id}" class="removeBtn text-red-500 text-sm">❌</button>
      </div>
    `;
    cartList.appendChild(row);
  });
  cartList.querySelectorAll('.removeBtn').forEach(btn => {
    btn.addEventListener('click', () => removeFromCart(btn.dataset.id));
  });
  calcTotal();
}
function addToCart(plant){
  const existing = state.cart.find(i => String(i.id) === String(plant.id));
  if (existing) {
    existing.qty += 1;
  } else {
    state.cart.push({ id: plant.id, name: plant.name, price: Number(plant.price) || 0, qty: 1 });
  }
  renderCart();
}
function removeFromCart(id){
  state.cart = state.cart.filter(i => String(i.id) !== String(id));
  renderCart();
}

/* ========== CATEGORY LOADING ========== */
async function loadCategories(){
  try {
    categoriesEl.innerHTML = '<div class="text-sm text-slate-500">Loading categories...</div>';
    const res = await fetch(API.categories);
    const json = await res.json();
    console.log('categories raw response:', json);
    // flexible extraction:
    let cats = json && (json.data ?? json) ;
    // If nested under 'categories' or other shapes:
    if (!Array.isArray(cats)) {
      if (cats && Array.isArray(cats.categories)) cats = cats.categories;
      else if (cats && typeof cats === 'object') cats = Object.values(cats);
      else cats = [];
    }
    // normalize categories into {id, name}
    state.categories = (cats || []).map(c => {
      const id = c?.id ?? c?.category_id ?? c?.cat_id ?? c?._id ?? c?.key ?? c?.category ?? (c?.name ? c.name : null);
      const name = c?.name ?? c?.category_name ?? c?.title ?? c?.category ?? String(id) ?? 'Category';
      return { raw: c, id, name };
    }).filter(c => c.id !== null && c.id !== undefined);
    renderCategories();
  } catch (err){
    console.error('Failed to load categories', err);
    categoriesEl.innerHTML = '<div class="text-sm text-red-500">Failed to load categories</div>';
  }
}
function renderCategories(){
  categoriesEl.innerHTML = '';
  // Add "All Trees" button first
  const allBtn = document.createElement('button');
  allBtn.className = `text-left px-3 py-2 rounded ${String(state.activeCategoryId) === 'all' ? 'bg-emerald-800 text-white' : 'bg-emerald-50 text-emerald-800'}`;
  allBtn.textContent = 'All Trees';
  allBtn.dataset.id = 'all';
  allBtn.addEventListener('click', () => selectCategory('all'));
  categoriesEl.appendChild(allBtn);

  if (state.categories.length === 0) {
    // no categories returned from API
    const hint = document.createElement('div');
    hint.className = 'text-sm text-slate-500 mt-2';
    hint.textContent = 'No categories found.';
    categoriesEl.appendChild(hint);
    return;
  }

  state.categories.forEach(c => {
    const btn = document.createElement('button');
    btn.className = `text-left px-3 py-2 rounded ${String(state.activeCategoryId) === String(c.id) ? 'bg-emerald-800 text-white' : 'bg-emerald-50 text-emerald-800'}`;
    btn.textContent = c.name;
    btn.dataset.id = c.id;
    btn.addEventListener('click', () => selectCategory(c.id));
    categoriesEl.appendChild(btn);
  });
}

/* ========== LOAD PLANTS ========== */
async function loadAllPlants(){
  try {
    cardsGrid.innerHTML = '';
    showSpinner();
    const res = await fetch(API.allPlants);
    const json = await res.json();
    console.log('all plants raw response:', json);
    let items = json && (json.data ?? json);
    if (!Array.isArray(items)) {
      // some APIs return object keyed by id
      if (items && Array.isArray(items.plants)) items = items.plants;
      else if (items && typeof items === 'object') items = Object.values(items);
      else items = [];
    }
    state.plants = normalizePlants(items);
    renderPlants();
  } catch (err){
    console.error('Failed to load all plants', err);
    cardsGrid.innerHTML = '<div class="text-sm text-red-500">Failed to load plants.</div>';
  } finally {
    hideSpinner();
  }
}

async function loadPlantsByCategory(id){
  try {
    cardsGrid.innerHTML = '';
    showSpinner();
    // call category endpoint; many APIs return different shapes - we'll try to handle them:
    const res = await fetch(API.category(id));
    const json = await res.json();
    console.log(`plants by category (${id}) raw response:`, json);
    let items = json && (json.data ?? json);
    if (!Array.isArray(items)) {
      if (items && Array.isArray(items.plants)) items = items.plants;
      else if (items && typeof items === 'object') items = Object.values(items);
      else items = [];
    }
    state.plants = normalizePlants(items);
    renderPlants();
  } catch (err){
    console.error('Failed to load plants by category', err);
    cardsGrid.innerHTML = '<div class="text-sm text-red-500">Failed to load plants for this category.</div>';
  } finally {
    hideSpinner();
  }
}

function normalizePlants(items){
  return (items || []).map((p, idx) => {
    const id = p?.id ?? p?.plant_id ?? p?._id ?? p?.key ?? (p?.name ? idx + 1 : idx+1);
    const name = p?.name ?? p?.plant_name ?? p?.title ?? `Plant ${id}`;
    const description = (p?.description ?? p?.short_description ?? p?.details ?? '').toString().slice(0,140);
    const longDescription = p?.description ?? p?.details ?? p?.long_description ?? p?.about ?? '';
    const image = p?.image ?? p?.img ?? p?.picture ?? (p?.images && p.images[0]) ?? '';
    const category = p?.category ?? p?.cat ?? p?.category_name ?? '';
    const price = Number(p?.price ?? p?.cost ?? p?.fee ?? (Math.floor(Math.random()*500)+200));
    return { raw: p, id, name, description, longDescription, image, category, price };
  });
}

/* ========== RENDER PLANTS (cards) ========== */
function renderPlants(){
  cardsGrid.innerHTML = '';
  if (!state.plants || state.plants.length === 0){
    cardsGrid.innerHTML = '<div class="text-sm text-slate-500">No plants found for this selection.</div>';
    return;
  }
  state.plants.forEach(plant => {
    const card = document.createElement('div');
    card.className = 'bg-white p-4 rounded shadow flex flex-col';
    card.innerHTML = `
      <div class="card-img-placeholder mb-3" style="background-image: url('${plant.image || ''}'); background-size:cover; background-position:center; min-height:140px;"></div>
      <div class="flex-1">
        <button class="plantName text-left block font-semibold truncate" data-id="${plant.id}">${plant.name}</button>
        <p class="text-xs text-slate-600 mt-1">${plant.description || 'No description available.'}</p>
      </div>
      <div class="mt-3 flex items-center justify-between">
        <div><div class="text-xs bg-emerald-50 px-2 py-1 rounded text-emerald-700">${plant.category || 'General'}</div></div>
        <div class="text-sm font-semibold">${formatPrice(plant.price)}</div>
      </div>
      <div class="mt-3">
        <button class="addToCartBtn w-full py-2 rounded bg-emerald-700 text-white" data-id="${plant.id}">Add to Cart</button>
      </div>
    `;
    cardsGrid.appendChild(card);
  });

  // listeners
  document.querySelectorAll('.addToCartBtn').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.dataset.id;
      const plant = state.plants.find(p => String(p.id) === String(id));
      if (plant) addToCart(plant);
    });
  });
  document.querySelectorAll('.plantName').forEach(btn => {
    btn.addEventListener('click', async () => {
      const id = btn.dataset.id;
      await showPlantDetail(id);
    });
  });
}

/* ========== CATEGORY SELECT ========== */
async function selectCategory(id){
  state.activeCategoryId = String(id);
  renderCategories();
  if (String(id) === 'all') {
    await loadAllPlants();
  } else {
    await loadPlantsByCategory(id);
  }
}

/* ========== Detail modal ========== */
async function showPlantDetail(id){
  try {
    // try detail endpoint (not all APIs provide detail); if fails, fall back to state.plants value
    let plantData = state.plants.find(p => String(p.id) === String(id)) || null;
    try {
      const res = await fetch(API.plant(id));
      const json = await res.json();
      console.log(`plant detail raw response (${id}):`, json);
      let d = json && (json.data ?? json);
      // if d is object with nested, try common shapes:
      if (d && typeof d === 'object' && !Array.isArray(d)) {
        plantData = {
          id: d?.id ?? d?._id ?? d?.plant_id ?? id,
          name: d?.name ?? d?.title ?? d?.plant_name ?? (plantData?.name ?? 'Plant'),
          image: d?.image ?? d?.img ?? d?.photo ?? (plantData?.image || ''),
          longDescription: d?.description ?? d?.details ?? d?.about ?? (plantData?.longDescription || ''),
          price: Number(d?.price ?? d?.cost ?? plantData?.price ?? (Math.floor(Math.random()*500)+200)),
          category: d?.category ?? plantData?.category ?? 'General'
        };
      }
    } catch (err) {
      // ignore: use fallback plantData
    }

    if (!plantData) {
      modalContent.innerHTML = '<div class="text-sm text-red-500">Details not available.</div>';
      detailModal.classList.remove('hidden'); detailModal.classList.add('flex');
      return;
    }

    modalContent.innerHTML = `
      <div class="grid gap-4 md:grid-cols-2 items-start">
        <div><img src="${plantData.image || ''}" alt="${plantData.name}" class="w-full rounded object-cover max-h-80"></div>
        <div>
          <h3 class="text-xl font-semibold">${plantData.name}</h3>
          <div class="text-sm text-slate-600 mt-2">${plantData.longDescription || plantData.description || 'No details available.'}</div>
          <div class="mt-4">
            <div class="text-sm">Category: <span class="font-medium">${plantData.category || 'General'}</span></div>
            <div class="text-lg font-bold mt-2">${formatPrice(plantData.price)}</div>
            <div class="mt-4">
              <button id="modalAddToCart" class="px-4 py-2 rounded bg-emerald-700 text-white">Add to Cart</button>
            </div>
          </div>
        </div>
      </div>
    `;
    detailModal.classList.remove('hidden'); detailModal.classList.add('flex');
    document.getElementById('modalAddToCart')?.addEventListener('click', () => {
      addToCart({ id: plantData.id, name: plantData.name, price: plantData.price });
    });
  } catch (err) {
    console.error('Error showing plant detail', err);
  }
}

/* modal close */
closeModal.addEventListener('click', () => {
  detailModal.classList.add('hidden'); detailModal.classList.remove('flex');
});
detailModal.addEventListener('click', (e) => {
  if (e.target === detailModal) {
    detailModal.classList.add('hidden'); detailModal.classList.remove('flex');
  }
});

/* ========== Init ========== */
(async function init(){
  // Load categories and all plants concurrently, but default UI shows "All Trees"
  await Promise.all([loadCategories(), loadAllPlants()]);
  renderCart();
  hideSpinner();

  // donate form handler
  document.getElementById('donateForm').addEventListener('submit', (e) => {
    e.preventDefault();
    alert('Thank you! Donation recorded (demo only).');
    e.target.reset();
  });

  // top button behavior
  document.getElementById('plantTopBtn').addEventListener('click', ()=> {
    document.getElementById('plant').scrollIntoView({behavior: 'smooth'});
  });
  document.getElementById('getInvolvedBtn').addEventListener('click', ()=> {
    document.getElementById('cardsSection').scrollIntoView({behavior: 'smooth'});
  });
  document.getElementById('checkoutBtn').addEventListener('click', () => {
    if(state.cart.length === 0) alert('Your cart is empty.');
    else alert('Checkout demo — total: ' + cartTotalEl.textContent);
  });
})();
</script>

   
</body>
</html>
